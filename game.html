<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" type="text/css" href="/css/style.css">
</head>
<body>
	<button id="create-button">Create</button>
	<div id="container">

		<div id="left-side">
			<div id="left-area">
				<div id="left-bat">
				
				</div>
			</div>
		</div>
		<div id="middle"></div>
		<div id="right-side">
			<div id="right-area">
				<div id="right-bat">
				
				</div>
			</div>
		</div>
		
	</div>
</body>
	<script src="/socket.io/socket.io.js"></script>
	<script>
		const socket = io();

		const leftBat = document.getElementById('left-bat');

		const createButton = document.getElementById('create-button');

		var gameId = findGetParameter("gameId");

		if ( gameId != null) {
			createButton.style.display = "none";
			socket.emit('join', {"gameId": gameId});
		}

		createButton.addEventListener('click', (event) => {
			socket.emit('create', {})
		})

		document.addEventListener('keydown', (event) => {
			const pressedKey = event.key;
			const currentPosition = leftBat.offsetTop;
			switch (event.key) {
				case "ArrowDown":
					var newPos = currentPosition + 5 + "px"
					leftBat.style.top = newPos;
					socket.emit('move', newPos)
					break;
				case "ArrowUp":
					var newPos = currentPosition - 5 + "px"
					leftBat.style.top = newPos;
					socket.emit('move', newPos)
					break;
			}
			console.log(pressedKey);
		});

		socket.on('move', function(pos) {
			leftBat.style.top = pos;
		});
		socket.on('create', function(response) {
			window.location = window.location.protocol + "//" + window.location.host + window.location.pathname + "?gameId=" + response.gameId;
		})

		socket.on('test', () => {
			console.log('test');
		})

		function findGetParameter(parameterName) {
			var result = null,
				tmp = [];
			var items = location.search.substr(1).split("&");
			for (var index = 0; index < items.length; index++) {
				tmp = items[index].split("=");
				if (tmp[0] === parameterName) result = decodeURIComponent(tmp[1]);
			}
			return result;
		}

	  </script>
</script>
</html>